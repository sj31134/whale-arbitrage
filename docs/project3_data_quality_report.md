# 프로젝트 3 데이터 품질 분석 리포트

> **작성일**: 2025-11-23  
> **분석 목적**: 데이터 기간 불일치 및 품질 문제 진단 및 해결

---

## 1. 데이터 현황 요약

### 1.1 데이터 기간 비교

| 데이터 소스 | 기간 | 레코드 수 | 유효 데이터 | 비율 |
|------------|------|----------|------------|------|
| **펀딩비** | 2022-12-31 ~ 2025-11-23 | 1,059건 | 978건 | 92.4% |
| **변동성** | 2022-12-31 ~ 2025-11-23 | 1,059건 | 1,059건 | 100% ✅ |
| **고래 집중도** | 2022-12-31 ~ 2025-11-23 | 1,059건 | 1,059건 | 100% ✅ |
| **고래 거래금액** | 2022-12-31 ~ 2025-11-23 | 1,059건 | 1,059건 | 100% ✅ |
| **미결제약정 (OI)** | 2025-11-02 ~ 2025-11-23 | 22건 | 22건 | 2.1% ❌ |

### 1.2 공통 유효 기간

#### OI 제외 분석 (권장)
- **기간**: 2022-12-31 ~ 2025-11-23
- **일수**: 978일 (약 2.7년)
- **사용 가능한 특성**: 
  - `avg_funding_rate` ✅
  - `volatility_24h` ✅
  - `top100_richest_pct` ✅
  - `avg_transaction_value_btc` ✅

#### OI 포함 분석
- **기간**: 2025-11-02 ~ 2025-11-23
- **일수**: 22일 (매우 부족)
- **사용 가능한 특성**: 모든 특성 (하지만 데이터 부족)

---

## 2. 발견된 문제점

### 2.1 Critical 문제

#### ❌ OI 데이터 부족
- **현재**: 22일만 있음 (2025-11-02 ~ 2025-11-23)
- **필요**: 최소 1년 이상 (다른 데이터와 동일 기간)
- **부족량**: 1,037일 (약 2.8년)
- **영향**: 
  - `oi_growth_7d` 특성이 의미 없음
  - OI 기반 청산 리스크 예측 불가
  - 모델 성능 저하

**원인**:
- Binance API 제한: `/fapi/v1/openInterestHist`는 최근 30일만 제공
- 과거 데이터 수집 불가

### 2.2 해결 완료된 문제

#### ✅ 고래 데이터 이상치 처리 완료
- **`top100_richest_pct`**: 
  - 극단적 이상치 1건 (4923%) → 100%로 제한
  - 총 4건 수정
- **`avg_transaction_value_btc`**: 
  - 극단적 이상치 12건 (>10,000 BTC) → 99% 분위수로 제한
  - 총 198건 수정
- **0값 처리**: Forward Fill로 처리

#### ✅ 변동성 데이터 수집 완료
- **이전**: 모두 0.0
- **현재**: 1,059건 모두 유효 (100%)
- **평균 변동성**: 3.71%
- **범위**: 0.37% ~ 18.61%

---

## 3. 해결 방안

### 3.1 OI 데이터 수집 개선

#### 방안 1: 매일 자동 수집 (권장) ⭐

**설명**: Binance API로 최근 30일 데이터를 매일 수집하여 축적

**구현**:
```bash
# 매일 실행
python3 scripts/subprojects/risk_ai/collect_oi_historical.py
```

**예상 타임라인**:
- 30일 후: 30일치 데이터
- 1년 후: 1년치 데이터
- 3년 후: 3년치 데이터 (다른 데이터와 동일 기간)

**자동화 방법**:
- macOS: `launchd` 또는 `cron`
- Linux: `cron`
- GitHub Actions: 스케줄러 활용

#### 방안 2: 유료 API 사용

**대상 서비스**:
1. **CryptoQuant**: https://cryptoquant.com/
   - 무료 티어: 제한적
   - 유료 플랜: 월 $50~$200
   - 과거 데이터: 제공

2. **Glassnode**: https://glassnode.com/
   - 무료 티어: 제한적
   - 유료 플랜: 월 $29~$799
   - 과거 데이터: 제공

3. **Coinglass**: https://www.coinglass.com/
   - API 키 필요
   - 무료 티어: 제한적

#### 방안 3: OI 특성 제거 (임시 해결책)

**설명**: OI 관련 특성을 제거하고 다른 특성만 사용

**장점**:
- 즉시 적용 가능
- 데이터 일관성 확보
- 978일치 데이터로 분석 가능

**단점**:
- 예측력 저하 가능
- OI 정보 손실

**구현**:
- `feature_engineering.py`에서 `oi_growth_7d` 제거
- `sum_open_interest` 특성도 제거

---

## 4. 고래 데이터 품질 분석

### 4.1 이상치 처리 결과

#### 처리 전
- `top100_richest_pct`: 최대값 4,923% (명백한 오류)
- `avg_transaction_value_btc`: 최대값 258,576 BTC (명백한 오류)
- 이상치: 160건 (15.1%)

#### 처리 후
- `top100_richest_pct`: 최대값 100% (정상 범위)
- `avg_transaction_value_btc`: 최대값 10,566 BTC (99% 분위수)
- 이상치: 0건

### 4.2 데이터 분포

#### top100_richest_pct
- 중앙값: 17.98%
- 평균: 13.33% (이상치 제거 후)
- 범위: 0.02% ~ 100%
- 표준편차: 정상 범위

#### avg_transaction_value_btc
- 중앙값: 32.25 BTC
- 평균: 301.73 BTC (이상치 제거 후)
- 범위: 7.84 ~ 10,566 BTC
- 표준편차: 정상 범위

### 4.3 결론
✅ **고래 데이터는 분석에 충분함**
- 이상치 처리 완료
- 데이터 분포 정상
- 1,059일치 연속 데이터 확보

---

## 5. 최종 권장사항

### 즉시 실행

1. ✅ **고래 데이터 이상치 처리** - 완료
2. ✅ **변동성 데이터 수집** - 완료
3. ⏳ **OI 매일 자동 수집 설정** - 스크립트 준비 완료
4. ⏳ **OI 특성 임시 제거** - 데이터 축적될 때까지

### 단기 (1주일 이내)

1. **OI 자동 수집 스케줄러 설정**
   - cron job 또는 launchd 설정
   - 매일 자정 자동 실행

2. **Feature Engineering 수정**
   - OI 특성 제거 또는 조건부 사용
   - 모델 재학습

### 중기 (1개월 이내)

1. **유료 API 검토** (예산이 있다면)
   - CryptoQuant/Glassnode API 키 발급
   - 과거 데이터 즉시 확보

2. **데이터 모니터링 시스템 구축**
   - 데이터 품질 자동 검증
   - 이상치 자동 탐지 및 처리

---

## 6. 분석 가능한 기간

### 현재 상황

#### OI 제외 분석 (권장)
- ✅ **기간**: 2022-12-31 ~ 2025-11-23
- ✅ **일수**: 978일 (약 2.7년)
- ✅ **특성**: 4개 (펀딩비, 변동성, 고래 집중도, 고래 거래금액)
- ✅ **분석 가능**: 즉시 가능

#### OI 포함 분석
- ❌ **기간**: 2025-11-02 ~ 2025-11-23
- ❌ **일수**: 22일 (부족)
- ❌ **분석 가능**: 불가 (데이터 부족)

### 권장 분석 방법

**현재**: OI 특성을 제거하고 978일치 데이터로 분석
- 충분한 데이터 확보
- 모델 학습 가능
- 성능 평가 가능

**향후**: OI 데이터가 축적되면 (1년 후) OI 특성 추가
- 더 많은 특성 활용
- 예측력 향상 가능

---

## 7. 실행 스크립트

### 7.1 데이터 품질 분석
```bash
python3 scripts/subprojects/risk_ai/analyze_data_quality.py
```

### 7.2 고래 데이터 이상치 처리
```bash
python3 scripts/subprojects/risk_ai/fix_whale_data_outliers.py
```

### 7.3 변동성 데이터 업데이트
```bash
python3 scripts/subprojects/risk_ai/update_volatility_data.py
```

### 7.4 OI 데이터 수집 (매일 실행)
```bash
python3 scripts/subprojects/risk_ai/collect_oi_historical.py
```

### 7.5 데이터 정렬 검증
```bash
python3 scripts/subprojects/risk_ai/verify_data_alignment.py
```

---

## 8. 결론

### 완료된 작업
- ✅ 고래 데이터 이상치 처리
- ✅ 변동성 데이터 수집
- ✅ 데이터 품질 분석

### 남은 작업
- ⏳ OI 데이터 매일 자동 수집 설정
- ⏳ OI 특성 제거 또는 조건부 사용
- ⏳ 모델 재학습 (OI 제외)

### 최종 상태
- **분석 가능**: OI 제외 978일치 데이터로 즉시 분석 가능
- **데이터 품질**: 양호 (이상치 처리 완료)
- **고래 데이터**: 충분함 (1,059일치, 이상치 처리 완료)
- **OI 데이터**: 부족 (22일, 매일 수집으로 축적 필요)

---

**작성자**: AI Assistant  
**마지막 업데이트**: 2025-11-23

