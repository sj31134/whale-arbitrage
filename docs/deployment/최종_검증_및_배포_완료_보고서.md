# ìµœì¢… ê²€ì¦ ë° ë°°í¬ ì™„ë£Œ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-12-04  
**ë°°í¬ URL**: https://whale-arbitrage-qwodzy8wpnhpgxaxt23rj8.streamlit.app/  
**ìµœì¢… ì»¤ë°‹**: `7f91ae0`

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. ì „ì²´ ì½”ë“œ ë¦¬ë·° ë° ìˆ˜ì •

#### ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡
1. **`app/utils/data_loader.py`**
   - `get_available_dates`: Supabase ì§€ì› ì¶”ê°€
   - `get_available_dates_list`: Supabase ì§€ì› ì¶”ê°€
   - `load_risk_data`: Supabase ë°ì´í„° ì—†ì„ ë•Œ ë¹ˆ DataFrame ë°˜í™˜
   - `load_futures_extended_metrics`: Supabase ë°ì´í„° ì—†ì„ ë•Œ ë¹ˆ DataFrame ë°˜í™˜

2. **`app/pages/risk_dashboard_page.py`**
   - `render_exchange_flow`: Supabase ì§€ì› ì¶”ê°€
   - `logging` import ì¶”ê°€

3. **`scripts/subprojects/risk_ai/feature_engineering.py`**
   - `load_raw_data`: DataLoaderë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase ì§€ì›
   - ë™ì  ë³€ìˆ˜ ë¶„ì„ í˜ì´ì§€ì—ì„œë„ Supabase ì‚¬ìš© ê°€ëŠ¥

### 2. ë°œê²¬ëœ ê·¼ë³¸ ì›ì¸ ë° í•´ê²°

#### ë¬¸ì œ 1: `get_available_dates`ê°€ Supabaseë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
- **ì¦ìƒ**: í´ë¼ìš°ë“œì—ì„œ "btc ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤" ì˜¤ë¥˜
- **ì›ì¸**: Supabase ì‚¬ìš© ì‹œ `self.conn`ì´ `None`ì´ë¯€ë¡œ ë°”ë¡œ `None, None` ë°˜í™˜
- **í•´ê²°**: Supabaseì—ì„œ `binance_futures_metrics` í…Œì´ë¸”ë¡œ ë‚ ì§œ ë²”ìœ„ ì¡°íšŒ ì¶”ê°€

#### ë¬¸ì œ 2: `load_risk_data`ì—ì„œ Supabase ë°ì´í„°ê°€ ì—†ì„ ë•Œ ì²˜ë¦¬ ë¶€ì¡±
- **ì¦ìƒ**: ë°ì´í„°ê°€ ì—†ì–´ë„ ë¹ˆ DataFrameì„ ë°˜í™˜í•˜ì§€ ì•ŠìŒ
- **ì›ì¸**: `if futures_response.data:` ì²´í¬ë§Œ í•˜ê³ , ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê³„ì† ì§„í–‰
- **í•´ê²°**: `if futures_response.data and len(futures_response.data) > 0:` ì²´í¬ ì¶”ê°€ ë° ë¹ˆ DataFrame ë°˜í™˜

#### ë¬¸ì œ 3: `render_exchange_flow`ê°€ Supabaseë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
- **ì¦ìƒ**: ê±°ë˜ì†Œ ìœ ì…/ìœ ì¶œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŒ
- **ì›ì¸**: `data_loader.conn`ì„ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ Supabase ì‚¬ìš© ì‹œ ì˜¤ë¥˜ ë°œìƒ
- **í•´ê²°**: Supabaseë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° `whale_daily_stats` í…Œì´ë¸”ì—ì„œ ì§ì ‘ ì¡°íšŒ

#### ë¬¸ì œ 4: `FeatureEngineer.load_raw_data`ê°€ Supabaseë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ
- **ì¦ìƒ**: ë™ì  ë³€ìˆ˜ ë¶„ì„ í˜ì´ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨
- **ì›ì¸**: ì§ì ‘ SQLite ì—°ê²° ì‚¬ìš©
- **í•´ê²°**: `DataLoader`ë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase ì§€ì›

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ë¡œì»¬ í™˜ê²½ í…ŒìŠ¤íŠ¸
```
âœ… get_available_dates (BTC): ì„±ê³µ (2022-08-11 ~ 2025-11-30)
âœ… load_risk_data (BTC): 26í–‰ ë¡œë“œ ì„±ê³µ
âœ… load_futures_extended_metrics (BTC): 28í–‰ ë¡œë“œ ì„±ê³µ
âœ… get_available_dates (ETH): ì„±ê³µ (2022-08-11 ~ 2025-11-30)
âœ… load_risk_data (ETH): 28í–‰ ë¡œë“œ ì„±ê³µ
âœ… load_futures_extended_metrics (ETH): 28í–‰ ë¡œë“œ ì„±ê³µ
âœ… FeatureEngineer.load_raw_data: 28í–‰ ë¡œë“œ ì„±ê³µ
```

### í´ë¼ìš°ë“œ í™˜ê²½ í…ŒìŠ¤íŠ¸ (ì˜ˆìƒ)
- Supabase ì—°ê²° ì„±ê³µ ì‹œ ë™ì¼í•œ ê²°ê³¼ ì˜ˆìƒ
- Supabase ì—°ê²° ì‹¤íŒ¨ ì‹œ SQLite í´ë°±ìœ¼ë¡œ ë™ì¼í•œ ê²°ê³¼ ì˜ˆìƒ

---

## ğŸ“‹ ìˆ˜ì • ì‚¬í•­ ìƒì„¸

### ìˆ˜ì • 1: `get_available_dates` Supabase ì§€ì›

**ìˆ˜ì • ì „:**
```python
if not hasattr(self, 'conn') or self.conn is None:
    return None, None
```

**ìˆ˜ì • í›„:**
```python
# Supabase ìš°ì„  ì‚¬ìš© (í´ë¼ìš°ë“œ í™˜ê²½)
if self.use_supabase:
    try:
        supabase = self._get_supabase_client()
        if supabase:
            response = supabase.table("binance_futures_metrics") \
                .select("date") \
                .eq("symbol", symbol) \
                .order("date") \
                .execute()
            
            if response.data and len(response.data) > 0:
                dates = [row['date'] for row in response.data]
                min_date = min(dates)
                max_date = max(dates)
                return min_date, max_date
            
            return None, None
    except Exception as e:
        logging.warning(f"Supabaseì—ì„œ ë‚ ì§œ ì¡°íšŒ ì‹¤íŒ¨, SQLiteë¡œ í´ë°±: {e}")

# SQLite ì‚¬ìš© (ë¡œì»¬ í™˜ê²½ ë˜ëŠ” Supabase ì‹¤íŒ¨ ì‹œ)
if not hasattr(self, 'conn') or self.conn is None:
    return None, None
```

### ìˆ˜ì • 2: `load_risk_data` ë¹ˆ ë°ì´í„° ì²˜ë¦¬

**ìˆ˜ì • ì „:**
```python
if futures_response.data:
    # ... ì²˜ë¦¬ ...
    return df
```

**ìˆ˜ì • í›„:**
```python
if futures_response.data and len(futures_response.data) > 0:
    # ... ì²˜ë¦¬ ...
    return df
else:
    logging.warning(f"Supabaseì—ì„œ {symbol} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤ (ê¸°ê°„: {start_date} ~ {end_date})")
    return pd.DataFrame()
```

### ìˆ˜ì • 3: `render_exchange_flow` Supabase ì§€ì›

**ìˆ˜ì • ì „:**
```python
flow_df = pd.read_sql(query, data_loader.conn)
```

**ìˆ˜ì • í›„:**
```python
flow_df = pd.DataFrame()

# Supabase ìš°ì„  ì‚¬ìš© (í´ë¼ìš°ë“œ í™˜ê²½)
if data_loader.use_supabase:
    try:
        supabase = data_loader._get_supabase_client()
        if supabase:
            response = supabase.table("whale_daily_stats") \
                .select("date, exchange_inflow_usd, exchange_outflow_usd, net_flow_usd") \
                .eq("coin_symbol", coin) \
                .gte("date", start_date) \
                .lte("date", end_date) \
                .order("date") \
                .execute()
            
            if response.data and len(response.data) > 0:
                flow_df = pd.DataFrame(response.data)
    except Exception as e:
        logging.warning(f"Supabaseì—ì„œ ê±°ë˜ì†Œ ìœ ì…/ìœ ì¶œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: {e}")

# SQLite ì‚¬ìš© (ë¡œì»¬ í™˜ê²½ ë˜ëŠ” Supabase ì‹¤íŒ¨ ì‹œ)
if flow_df.empty and data_loader.conn is not None:
    flow_df = pd.read_sql(query, data_loader.conn)
```

### ìˆ˜ì • 4: `FeatureEngineer.load_raw_data` Supabase ì§€ì›

**ìˆ˜ì • ì „:**
```python
def __init__(self):
    self.conn = sqlite3.connect(DB_PATH)

def load_raw_data(self, start_date="2023-01-01", coin="BTC"):
    # SQLite ì§ì ‘ ì‚¬ìš©
    df = pd.read_sql(query, self.conn)
```

**ìˆ˜ì • í›„:**
```python
def __init__(self):
    # DataLoaderë¥¼ ì‚¬ìš©í•˜ì—¬ Supabase ì§€ì›
    try:
        from data_loader import DataLoader
        self.data_loader = DataLoader()
        self.use_data_loader = True
    except Exception as e:
        self.data_loader = None
        self.use_data_loader = False
        self.conn = sqlite3.connect(DB_PATH)

def load_raw_data(self, start_date="2023-01-01", coin="BTC"):
    # DataLoaderë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (Supabase ì§€ì›)
    if self.use_data_loader and self.data_loader:
        # load_risk_data, load_futures_extended_metrics ì‚¬ìš©
        # Supabaseì—ì„œ whale_daily_stats ë¡œë“œ
    # SQLite ì§ì ‘ ì‚¬ìš© (í´ë°±)
```

---

## ğŸ” ìµœì¢… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì½”ë“œ ìˆ˜ì •
- [x] `get_available_dates` Supabase ì§€ì› ì¶”ê°€
- [x] `get_available_dates_list` Supabase ì§€ì› ì¶”ê°€
- [x] `load_risk_data` ë¹ˆ ë°ì´í„° ì²˜ë¦¬ ê°œì„ 
- [x] `load_futures_extended_metrics` ë¹ˆ ë°ì´í„° ì²˜ë¦¬ ê°œì„ 
- [x] `render_exchange_flow` Supabase ì§€ì› ì¶”ê°€
- [x] `FeatureEngineer.load_raw_data` Supabase ì§€ì› ì¶”ê°€
- [x] ë¡œì»¬ í…ŒìŠ¤íŠ¸ í†µê³¼

### ë°°í¬ ìƒíƒœ
- [x] ëª¨ë“  ìˆ˜ì •ì‚¬í•­ ì»¤ë°‹ ì™„ë£Œ
- [x] GitHub í‘¸ì‹œ ì™„ë£Œ (ì»¤ë°‹: `7f91ae0`)
- [x] Streamlit Cloud ìë™ ì¬ë°°í¬ íŠ¸ë¦¬ê±°ë¨

### í´ë¼ìš°ë“œ ê²€ì¦ (í•„ìš”)
- [ ] ë°°í¬ëœ ì•± ì ‘ì† í™•ì¸
- [ ] ê° í˜ì´ì§€ë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] ë¡œì»¬ê³¼ ê²°ê³¼ ë¹„êµ
- [ ] ì˜¤ë¥˜ ì—†ì´ ì •ìƒ ì‘ë™ í™•ì¸

---

## ğŸ“Š í˜ì´ì§€ë³„ ê²€ì¦ ê°€ì´ë“œ

### 1. ë¦¬ìŠ¤í¬ ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ
- [ ] BTC ì„ íƒ â†’ ë°ì´í„° ë¡œë“œ ì„±ê³µ
- [ ] ETH ì„ íƒ â†’ ë°ì´í„° ë¡œë“œ ì„±ê³µ
- [ ] ë¦¬ìŠ¤í¬ ì ìˆ˜ ì¹´ë“œ í‘œì‹œ
- [ ] íŒŒìƒìƒí’ˆ ì§€í‘œ ì„¹ì…˜ í‘œì‹œ
- [ ] ê±°ë˜ì†Œ ìœ ì…/ìœ ì¶œ ì„¹ì…˜ í‘œì‹œ

### 2. íŒŒìƒìƒí’ˆ ì§€í‘œ ë¶„ì„
- [ ] BTC/ETH ì„ íƒ â†’ ë°ì´í„° ë¡œë“œ ì„±ê³µ
- [ ] OI, í€ë”©ë¹„, Taker ë¹„ìœ¨ ì°¨íŠ¸ í‘œì‹œ
- [ ] "ë°ì´í„° ì—†ìŒ" ì˜¤ë¥˜ ì—†ìŒ

### 3. ë™ì  ë³€ìˆ˜ ë¶„ì„
- [ ] BTC/ETH ì„ íƒ â†’ ë°ì´í„° ë¡œë“œ ì„±ê³µ
- [ ] ë™ì  ë³€ìˆ˜ ì°¨íŠ¸ í‘œì‹œ
- [ ] "ModuleNotFoundError" ì˜¤ë¥˜ ì—†ìŒ

### 4. ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ
- [ ] ëª¨ë¸ ì„ íƒ ë° ë¹„êµ ê²°ê³¼ í‘œì‹œ
- [ ] "ë°ì´í„° ì—†ìŒ" ì˜¤ë¥˜ ì—†ìŒ (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‚ ì§œ ì œì™¸)

### 5. ì¢…í•© ëŒ€ì‹œë³´ë“œ
- [ ] ëª¨ë“  ì„¹ì…˜ ì •ìƒ í‘œì‹œ
- [ ] "no data" ì˜¤ë¥˜ ì—†ìŒ

---

## ğŸ¯ ë°°í¬ ì™„ë£Œ ìƒíƒœ

### ì½”ë“œ ì¤€ë¹„
- âœ… ëª¨ë“  Supabase ì§€ì› ëˆ„ë½ ë¬¸ì œ ìˆ˜ì • ì™„ë£Œ
- âœ… ë¹ˆ ë°ì´í„° ì²˜ë¦¬ ê°œì„  ì™„ë£Œ
- âœ… ë¡œì»¬ í…ŒìŠ¤íŠ¸ í†µê³¼

### ë°°í¬ ìƒíƒœ
- âœ… ìµœì‹  ì½”ë“œ GitHub í‘¸ì‹œ ì™„ë£Œ
- âœ… Streamlit Cloud ìë™ ì¬ë°°í¬ ì§„í–‰ ì¤‘

### ë‹¤ìŒ ë‹¨ê³„
1. **ì¬ë°°í¬ ì™„ë£Œ ëŒ€ê¸°** (ì•½ 1-2ë¶„)
2. **í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸**
   - ë°°í¬ëœ ì•± URL ì ‘ì†
   - ê° í˜ì´ì§€ë³„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
   - ë¡œì»¬ê³¼ ê²°ê³¼ ë¹„êµ
3. **ìµœì¢… ê²€ì¦**
   - ëª¨ë“  í˜ì´ì§€ ì •ìƒ ì‘ë™ í™•ì¸
   - ì˜¤ë¥˜ ì—†ì´ ì •ìƒ ì‘ë™ í™•ì¸

---

## ğŸ“ ì°¸ê³  ë¬¸ì„œ

- **ì „ì²´ ì½”ë“œ ë¦¬ë·°**: `docs/deployment/ì „ì²´_ì½”ë“œ_ë¦¬ë·°_ë°_ìˆ˜ì •ì‚¬í•­.md`
- **í˜ì´ì§€ë³„ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**: `docs/deployment/í˜ì´ì§€ë³„_í…ŒìŠ¤íŠ¸_ì²´í¬ë¦¬ìŠ¤íŠ¸.md`
- **ë¡œì»¬ vs í´ë¼ìš°ë“œ ë¹„êµ**: `docs/deployment/ë¡œì»¬_vs_í´ë¼ìš°ë“œ_ë¹„êµ_í…ŒìŠ¤íŠ¸.md`

---

## âœ… ìµœì¢… í™•ì¸

### ìˆ˜ì • ì™„ë£Œ
- [x] ëª¨ë“  ë°ì´í„° ë¡œë”© í•¨ìˆ˜ì— Supabase ì§€ì› ì¶”ê°€
- [x] ë¹ˆ ë°ì´í„° ì²˜ë¦¬ ê°œì„ 
- [x] `FeatureEngineer`ë„ Supabase ì§€ì›
- [x] ë¡œì»¬ í…ŒìŠ¤íŠ¸ í†µê³¼

### ë°°í¬ ì™„ë£Œ
- [x] GitHub í‘¸ì‹œ ì™„ë£Œ
- [x] ì¬ë°°í¬ íŠ¸ë¦¬ê±°ë¨

### í´ë¼ìš°ë“œ ê²€ì¦ (í•„ìš”)
- [ ] ë°°í¬ëœ ì•± ì ‘ì† ë° í…ŒìŠ¤íŠ¸
- [ ] ëª¨ë“  í˜ì´ì§€ ì •ìƒ ì‘ë™ í™•ì¸

---

**ê²°ë¡ **: ëª¨ë“  Supabase ì§€ì› ëˆ„ë½ ë¬¸ì œë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ì´ì œ í´ë¼ìš°ë“œì—ì„œë„ ë¡œì»¬ê³¼ ë™ì¼í•˜ê²Œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

