# ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜ ì›ì¸ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ” ì˜¤ë¥˜ ë¶„ì„

### ë°œìƒí•œ ì˜¤ë¥˜
```
pandas.errors.DatabaseError
File "/mount/src/whale-arbitrage/app/utils/data_loader.py", line 89, in get_available_dates
    df = pd.read_sql(query, self.conn)
```

### ì˜¤ë¥˜ ë°œìƒ ìœ„ì¹˜
- `data_loader.get_available_dates('BTC')` í˜¸ì¶œ ì‹œ
- SQL ì¿¼ë¦¬ ì‹¤í–‰ ì¤‘ (`pd.read_sql`)

## ğŸ” ì›ì¸ ë¶„ì„

### 1. ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë¬¸ì œ

**í˜„ì¬ ì½”ë“œ (`app/utils/data_loader.py`):**
```python
def _download_database_if_needed(self):
    """Streamlit Cloudì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë‹¤ìš´ë¡œë“œ ì‹œë„"""
    try:
        import streamlit as st
        db_url = st.secrets.get("DATABASE_URL", None)
        if db_url:
            import urllib.request
            self.db_path.parent.mkdir(parents=True, exist_ok=True)
            urllib.request.urlretrieve(db_url, str(self.db_path))
    except:
        pass
```

**ë¬¸ì œì :**
1. âŒ **ì••ì¶• í•´ì œ ë¡œì§ ì—†ìŒ**: `DATABASE_URL`ì´ `.tar.gz` íŒŒì¼ì¸ë° ì••ì¶• í•´ì œë¥¼ í•˜ì§€ ì•ŠìŒ
2. âŒ **ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±**: `except: pass`ë¡œ ëª¨ë“  ì—ëŸ¬ë¥¼ ë¬´ì‹œí•˜ì—¬ ë¬¸ì œë¥¼ íŒŒì•…í•  ìˆ˜ ì—†ìŒ
3. âŒ **íŒŒì¼ ì¡´ì¬ í™•ì¸ ì—†ìŒ**: ë‹¤ìš´ë¡œë“œ í›„ íŒŒì¼ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŒ
4. âŒ **ê²½ë¡œ ë¬¸ì œ**: Streamlit Cloudì—ì„œ `/tmp` ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° ê²½ë¡œ ì„¤ì •ì´ ë¶ˆëª…í™•

### 2. ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ ì„¤ì • ë¬¸ì œ

**í˜„ì¬ ì½”ë“œ:**
```python
if os.path.exists('/mount/src'):
    # Streamlit Cloud
    ROOT = Path('/mount/src/whale-arbitrage')
    DB_PATH = Path('/tmp') / "project.db"
```

**ë¬¸ì œì :**
1. âŒ **ë‹¤ìš´ë¡œë“œ ê²½ë¡œì™€ ì‚¬ìš© ê²½ë¡œ ë¶ˆì¼ì¹˜**: ë‹¤ìš´ë¡œë“œëŠ” `self.db_path`ì— í•˜ì§€ë§Œ ì‹¤ì œ ê²½ë¡œëŠ” `DB_PATH`ë¡œ ì„¤ì •
2. âŒ **ì´ˆê¸°í™” ì‹œì  ë¬¸ì œ**: `__init__`ì—ì„œ `_download_database_if_needed()`ë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ, `self.db_path`ê°€ ì´ë¯¸ `DB_PATH`ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ê²½ë¡œê°€ ë§ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ

**í˜„ì¬ ì½”ë“œ:**
```python
def __init__(self):
    self.db_path = DB_PATH
    # ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ì—†ìœ¼ë©´ ë‹¤ìš´ë¡œë“œ ì‹œë„ (Streamlit Cloudìš©)
    if not self.db_path.exists():
        self._download_database_if_needed()
    
    if not self.db_path.exists():
        raise FileNotFoundError(f"ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {self.db_path}")
    
    self.conn = sqlite3.connect(self.db_path)
```

**ë¬¸ì œì :**
1. âŒ **ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ë§Œ ë°œìƒ**: ë‹¤ìš´ë¡œë“œê°€ ì‹¤íŒ¨í•´ë„ `FileNotFoundError`ë§Œ ë°œìƒí•˜ê³  ì›ì¸ì„ ì•Œ ìˆ˜ ì—†ìŒ
2. âŒ **ì—°ê²° í›„ ê²€ì¦ ì—†ìŒ**: ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì´ ì¡´ì¬í•˜ë”ë¼ë„ ì†ìƒë˜ì—ˆê±°ë‚˜ í…Œì´ë¸”ì´ ì—†ì„ ìˆ˜ ìˆìŒ

## ğŸ“‹ ê·¼ë³¸ ì›ì¸

### ì£¼ìš” ì›ì¸
1. **ì••ì¶• í•´ì œ ë¡œì§ ëˆ„ë½**: GitHub Releasesì— `.tar.gz` íŒŒì¼ë¡œ ì—…ë¡œë“œí–ˆì§€ë§Œ, ë‹¤ìš´ë¡œë“œ í›„ ì••ì¶• í•´ì œë¥¼ í•˜ì§€ ì•ŠìŒ
2. **ì—ëŸ¬ ì²˜ë¦¬ ë¶€ì¡±**: ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ì—†ë„ë¡ ëª¨ë“  ì—ëŸ¬ë¥¼ ë¬´ì‹œ
3. **ê²½ë¡œ ë¶ˆì¼ì¹˜**: ë‹¤ìš´ë¡œë“œ ê²½ë¡œì™€ ì‹¤ì œ ì‚¬ìš© ê²½ë¡œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ

### ì‹œë‚˜ë¦¬ì˜¤
1. Streamlit Cloudì—ì„œ ì•± ì‹œì‘
2. `DataLoader.__init__()` í˜¸ì¶œ
3. `/tmp/project.db` íŒŒì¼ì´ ì—†ìŒ
4. `_download_database_if_needed()` í˜¸ì¶œ
5. `.tar.gz` íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì§€ë§Œ ì••ì¶• í•´ì œí•˜ì§€ ì•ŠìŒ
6. `/tmp/project.db.tar.gz` íŒŒì¼ë§Œ ì¡´ì¬
7. `sqlite3.connect('/tmp/project.db')` ì‹œë„
8. íŒŒì¼ì´ ì—†ê±°ë‚˜ ì†ìƒë˜ì–´ `DatabaseError` ë°œìƒ

## âœ… í•´ê²° ë°©ì•ˆ

### 1. ì••ì¶• í•´ì œ ë¡œì§ ì¶”ê°€
- `.tar.gz` íŒŒì¼ ë‹¤ìš´ë¡œë“œ í›„ ì••ì¶• í•´ì œ
- `tarfile` ëª¨ë“ˆ ì‚¬ìš©

### 2. ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
- ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€

### 3. ê²½ë¡œ í†µì¼
- ë‹¤ìš´ë¡œë“œ ê²½ë¡œì™€ ì‚¬ìš© ê²½ë¡œ ì¼ì¹˜
- `/tmp` ë””ë ‰í† ë¦¬ ì‚¬ìš©

### 4. ê²€ì¦ ë¡œì§ ì¶”ê°€
- ë‹¤ìš´ë¡œë“œ í›„ íŒŒì¼ ì¡´ì¬ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
- í…Œì´ë¸” ì¡´ì¬ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-11-23

