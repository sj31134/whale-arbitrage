# ğŸ” ë¹„íŠ¸ê²Ÿ ë°ì´í„° ìˆ˜ì§‘ ë¶€ì¡± ì›ì¸ ë¶„ì„

> **ì‘ì„±ì¼**: 2025-11-23  
> **ë¬¸ì œ**: ë¹„íŠ¸ê²Ÿ ë°ì´í„°ê°€ 2025-05-07ë¶€í„°ë§Œ ìˆ˜ì§‘ë¨ (2024-01-01 ~ 2025-05-06 ëˆ„ë½)

---

## 1. ë¬¸ì œ í˜„ìƒ

- **ìš”ì²­ ê¸°ê°„**: 2024-01-01 ~ í˜„ì¬
- **ì‹¤ì œ ìˆ˜ì§‘**: 2025-05-07 ~ 2025-11-22 (200ì¼)
- **ëˆ„ë½ ê¸°ê°„**: 2024-01-01 ~ 2025-05-06 (493ì¼)

---

## 2. ì›ì¸ ë¶„ì„

### 2.1 API í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ 1: after/before ëª¨ë‘ ì§€ì •**
```python
params = {
    'symbol': 'BTCUSDT_SPBL',
    'period': '1day',
    'after': '1704034800000',  # 2024-01-01
    'before': '1704812400000',  # 2024-01-10
    'limit': 200
}
```
**ê²°ê³¼**: âœ… **2024-01-01 ë°ì´í„° ì •ìƒ ë°˜í™˜ë¨!**

**í…ŒìŠ¤íŠ¸ 2: before ì œê±° (afterë§Œ ì§€ì •)**
```python
params = {
    'symbol': 'BTCUSDT_SPBL',
    'period': '1day',
    'after': '1704034800000',  # 2024-01-01
    'limit': 200
}
```
**ê²°ê³¼**: âœ… **ìµœì‹  ë°ì´í„°ë¶€í„° ë°˜í™˜ë¨**

**í…ŒìŠ¤íŠ¸ 3: ë‹¤ì–‘í•œ ë‚ ì§œ ë²”ìœ„ í…ŒìŠ¤íŠ¸**
- 2024-01-01 ~ 2024-01-10: âœ… 9ê±´ ë°˜í™˜
- 2024-06-01 ~ 2024-06-10: âœ… 9ê±´ ë°˜í™˜
- 2024-12-01 ~ 2024-12-10: âœ… 9ê±´ ë°˜í™˜
- 2025-01-01 ~ 2025-01-10: âœ… 9ê±´ ë°˜í™˜
- 2025-05-01 ~ 2025-05-10: âœ… 9ê±´ ë°˜í™˜

**ê²°ë¡ **: ë¹„íŠ¸ê²Ÿ APIëŠ” **2024-01-01ë¶€í„°ì˜ ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ì œê³µ**í•©ë‹ˆë‹¤!

---

### 2.2 ìŠ¤í¬ë¦½íŠ¸ ë¬¸ì œì 

**í˜„ì¬ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§:**
```python
params = {
    "symbol": symbol_api,
    "period": "1day",
    "after": str(start_ts),      # 2024-01-01
    "before": str(end_ts),       # í˜„ì¬ ì‹œê°„ (2025-11-23)
    "limit": 200
}
```

**ë¬¸ì œì :**
1. **ë¹„íŠ¸ê²Ÿ APIì˜ ë™ì‘ ë°©ì‹**: `before`ì™€ `after`ë¥¼ ëª¨ë‘ ì§€ì •í•˜ë©´, **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœìœ¼ë¡œ limit ê°œìˆ˜ë§Œí¼ ë°˜í™˜**
   - `before=í˜„ì¬ì‹œê°„, after=2024-01-01, limit=200` ìš”ì²­ ì‹œ
   - APIëŠ” **í˜„ì¬ ì‹œê°„ë¶€í„° ì—­ìˆœìœ¼ë¡œ 200ê°œ**ë¥¼ ë°˜í™˜
   - ê²°ê³¼: 2025-11-22 ~ 2025-05-07 (200ì¼)ë§Œ ë°˜í™˜ë¨

2. **í˜ì´ì§€ë„¤ì´ì…˜ ë¡œì§ ì˜¤ë¥˜**:
   - ìŠ¤í¬ë¦½íŠ¸ëŠ” `oldest_ts + 1ì¼`ë¡œ ë‹¤ìŒ ìš”ì²­ ì‹œì‘ì ì„ ì„¤ì •
   - í•˜ì§€ë§Œ ì´ë¯¸ ìµœì‹  ë°ì´í„°ë¶€í„° ë°˜í™˜ë˜ì—ˆìœ¼ë¯€ë¡œ, ë‹¤ìŒ ìš”ì²­ë„ ê³„ì† ìµœì‹  ë°ì´í„°ë§Œ ë°˜í™˜
   - ê²°ê³¼: ê°™ì€ ê¸°ê°„(2025-05-07 ~ 2025-11-22)ì„ ë°˜ë³µ ìˆ˜ì§‘

---

## 3. ê·¼ë³¸ ì›ì¸

### 3.1 ë¹„íŠ¸ê²Ÿ APIì˜ ë°ì´í„° ë°˜í™˜ ë°©ì‹

ë¹„íŠ¸ê²Ÿ APIëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤:

1. **`before`ì™€ `after` ëª¨ë‘ ì§€ì • ì‹œ**:
   - `before` ì‹œê°„ ì´ì „, `after` ì‹œê°„ ì´í›„ì˜ ë°ì´í„° ì¤‘
   - **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœìœ¼ë¡œ** `limit` ê°œìˆ˜ë§Œí¼ ë°˜í™˜
   - ì˜ˆ: `before=í˜„ì¬, after=2024-01-01, limit=200` â†’ 2025-11-22 ~ 2025-05-07 ë°˜í™˜

2. **`after`ë§Œ ì§€ì • ì‹œ**:
   - `after` ì‹œê°„ ì´í›„ì˜ ë°ì´í„° ì¤‘
   - **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœìœ¼ë¡œ** `limit` ê°œìˆ˜ë§Œí¼ ë°˜í™˜

3. **`before`ë§Œ ì§€ì • ì‹œ**:
   - `before` ì‹œê°„ ì´ì „ì˜ ë°ì´í„° ì¤‘
   - **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœìœ¼ë¡œ** `limit` ê°œìˆ˜ë§Œí¼ ë°˜í™˜

### 3.2 ìŠ¤í¬ë¦½íŠ¸ì˜ ì˜ëª»ëœ ê°€ì •

**ì˜ëª»ëœ ê°€ì •**: APIê°€ `after` ì‹œê°„ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤ê³  ê°€ì •

**ì‹¤ì œ ë™ì‘**: APIëŠ” í•­ìƒ **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœ**ìœ¼ë¡œ ë°˜í™˜

---

## 4. í•´ê²° ë°©ì•ˆ

### 4.1 ë°©ë²• 1: `before`ë¥¼ ì ì§„ì ìœ¼ë¡œ ì¤„ì´ê¸° (ê¶Œì¥)

```python
def fetch_bitget_spot_fixed(symbol, start_date_str="2024-01-01"):
    """ë¹„íŠ¸ê²Ÿ ë°ì´í„° ìˆ˜ì§‘ (ìˆ˜ì • ë²„ì „)"""
    symbol_api = f"{symbol}_SPBL" if not symbol.endswith("_SPBL") else symbol
    symbol_clean = symbol.replace("_SPBL", "")
    
    start_dt = datetime.strptime(start_date_str, "%Y-%m-%d")
    start_ts = int(start_dt.timestamp() * 1000)
    end_ts = int(datetime.now().timestamp() * 1000)
    
    current_end_ts = end_ts  # í˜„ì¬ ì‹œê°„ë¶€í„° ì‹œì‘
    
    while current_end_ts > start_ts:
        params = {
            "symbol": symbol_api,
            "period": "1day",
            "after": str(start_ts),
            "before": str(current_end_ts),  # ì ì§„ì ìœ¼ë¡œ ì¤„ì„
            "limit": 200
        }
        
        # API í˜¸ì¶œ ë° ë°ì´í„° ì²˜ë¦¬
        # ...
        
        # ê°€ì¥ ì˜¤ë˜ëœ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ë‹¤ìŒ beforeë¡œ ì„¤ì •
        oldest_ts = min(timestamps)
        current_end_ts = oldest_ts - 1  # 1ms ì „ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì¤‘ë³µ ë°©ì§€
```

### 4.2 ë°©ë²• 2: ë‚ ì§œ ë²”ìœ„ë¥¼ ì‘ê²Œ ë‚˜ëˆ„ì–´ ìˆ˜ì§‘

```python
def fetch_bitget_spot_chunked(symbol, start_date_str="2024-01-01"):
    """ë¹„íŠ¸ê²Ÿ ë°ì´í„° ìˆ˜ì§‘ (ì²­í¬ ë‹¨ìœ„)"""
    start_dt = datetime.strptime(start_date_str, "%Y-%m-%d")
    end_dt = datetime.now()
    
    # 200ì¼ì”© ì²­í¬ë¡œ ë‚˜ëˆ„ê¸°
    chunk_days = 200
    current_start = start_dt
    
    while current_start < end_dt:
        current_end = min(current_start + timedelta(days=chunk_days), end_dt)
        
        start_ts = int(current_start.timestamp() * 1000)
        end_ts = int(current_end.timestamp() * 1000)
        
        params = {
            "symbol": symbol_api,
            "period": "1day",
            "after": str(start_ts),
            "before": str(end_ts),
            "limit": 200
        }
        
        # API í˜¸ì¶œ ë° ë°ì´í„° ì²˜ë¦¬
        # ...
        
        current_start = current_end
```

### 4.3 ë°©ë²• 3: `before` ì—†ì´ `after`ë§Œ ì‚¬ìš© (ë‹¨ìˆœí•˜ì§€ë§Œ ë¹„íš¨ìœ¨ì )

```python
def fetch_bitget_spot_simple(symbol, start_date_str="2024-01-01"):
    """ë¹„íŠ¸ê²Ÿ ë°ì´í„° ìˆ˜ì§‘ (ë‹¨ìˆœ ë²„ì „)"""
    # before ì—†ì´ afterë§Œ ì‚¬ìš©í•˜ë©´ ìµœì‹  ë°ì´í„°ë¶€í„° ë°˜í™˜
    # í•˜ì§€ë§Œ limit=200ì´ë¯€ë¡œ ìµœì‹  200ì¼ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
    # â†’ ì´ ë°©ë²•ì€ ê¶Œì¥í•˜ì§€ ì•ŠìŒ
```

---

## 5. ê¶Œì¥ í•´ê²°ì±…

**ë°©ë²• 1 (beforeë¥¼ ì ì§„ì ìœ¼ë¡œ ì¤„ì´ê¸°)**ì„ ê¶Œì¥í•©ë‹ˆë‹¤:

1. âœ… ëª¨ë“  ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘ ê°€ëŠ¥
2. âœ… API í˜¸ì¶œ íšŸìˆ˜ ìµœì†Œí™”
3. âœ… ì¤‘ë³µ ë°ì´í„° ë°©ì§€

---

## 6. ìˆ˜ì •ëœ ìŠ¤í¬ë¦½íŠ¸

ìˆ˜ì •ëœ ìŠ¤í¬ë¦½íŠ¸ëŠ” `scripts/subprojects/arbitrage/fetch_spot_quotes_fixed.py`ì— êµ¬í˜„ ì˜ˆì •.

---

## 7. ê²°ë¡ 

**ì›ì¸**: 
- ë¹„íŠ¸ê²Ÿ APIëŠ” `before`ì™€ `after`ë¥¼ ëª¨ë‘ ì§€ì •í•˜ë©´ **ìµœì‹  ë°ì´í„°ë¶€í„° ì—­ìˆœ**ìœ¼ë¡œ ë°˜í™˜
- ìŠ¤í¬ë¦½íŠ¸ëŠ” `after` ì‹œê°„ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ë°˜í™˜í•œë‹¤ê³  ì˜ëª» ê°€ì •
- ê²°ê³¼: ìµœì‹  200ì¼(2025-05-07 ~ 2025-11-22)ë§Œ ë°˜ë³µ ìˆ˜ì§‘

**í•´ê²°ì±…**:
- `before`ë¥¼ ì ì§„ì ìœ¼ë¡œ ì¤„ì—¬ê°€ë©° ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘
- ë˜ëŠ” ë‚ ì§œ ë²”ìœ„ë¥¼ ì‘ê²Œ ë‚˜ëˆ„ì–´ ìˆ˜ì§‘

**ë¹„íŠ¸ê²Ÿ APIëŠ” 2024-01-01ë¶€í„°ì˜ ë°ì´í„°ë¥¼ ì •ìƒì ìœ¼ë¡œ ì œê³µí•˜ë¯€ë¡œ, ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •ë§Œìœ¼ë¡œ í•´ê²° ê°€ëŠ¥í•©ë‹ˆë‹¤!**

