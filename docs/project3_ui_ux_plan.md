# Project 3 (Risk AI) UI/UX 기획서

> **작성일**: 2025-11-23  
> **프로젝트명**: Risk AI - 고변동성/청산 리스크 예측 서비스

---

## 1. 프로젝트 개요

### 1.1 목적
**BitInfoCharts 고래 지표와 바이낸스 선물 펀딩/OI 데이터를 결합하여 급격한 변동성 및 청산 리스크를 예측하는 AI 모델을 웹 UI로 제공**

### 1.2 타겟 사용자
- **투자자**: 고변동성 구간을 사전에 예측하여 리스크 관리
- **트레이더**: 청산 리스크가 높은 시점을 피하여 포지션 조정
- **연구자**: 고래 활동과 시장 변동성의 상관관계 분석

### 1.3 핵심 기능
1. **리스크 예측 대시보드**: 현재 시장의 고변동성/청산 리스크 예측
2. **역사적 분석**: 과거 데이터 기반 리스크 패턴 분석
3. **특성 중요도 분석**: 어떤 지표가 리스크 예측에 중요한지 시각화
4. **실시간 모니터링**: 최신 데이터 기반 리스크 점수 업데이트

---

## 2. 페이지 구조

### 2.1 메인 네비게이션
```
📊 차익거래 분석 서비스 (Project 2)
├── 📊 차익거래 비용 계산기
├── 🎯 최적 전략 추천
└── ⚠️ 리스크 예측 (Project 3) [NEW]
    ├── 📈 리스크 대시보드
    ├── 📊 역사적 분석
    └── 🔍 특성 분석
```

---

## 3. 페이지별 상세 기획

### 3.1 리스크 대시보드 (Risk Dashboard)

#### 3.1.1 목적
**현재 시장의 고변동성/청산 리스크를 한눈에 파악하고, 예측 확률과 주요 지표를 확인**

#### 3.1.2 레이아웃

```
┌─────────────────────────────────────────────────────────┐
│  ⚠️ 리스크 예측 대시보드                                  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📊 현재 리스크 점수                              │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐      │  │
│  │  │ 고변동성  │  │ 청산 리스크│  │ 종합 점수│      │  │
│  │  │  65%     │  │   42%    │  │   ⚠️ 중간 │      │  │
│  │  │ [게이지] │  │  [게이지] │  │  [게이지] │      │  │
│  │  └──────────┘  └──────────┘  └──────────┘      │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📈 주요 지표 (최근 7일)                          │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐      │  │
│  │  │ 고래 집중도│  │ 펀딩비   │  │ OI 변화  │      │  │
│  │  │  +2.3%   │  │  +0.05%  │  │  +15.2%  │      │  │
│  │  │ [차트]   │  │  [차트]  │  │  [차트]  │      │  │
│  │  └──────────┘  └──────────┘  └──────────┘      │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  🎯 예측 상세                                      │  │
│  │  • 다음날 고변동성 확률: 65%                       │  │
│  │  • 예상 변동성 범위: 3.5% ~ 6.2%                  │  │
│  │  • 권장 조치: 포지션 축소 권장                     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📅 최근 리스크 이력 (최근 30일)                   │  │
│  │  [타임라인 차트: 날짜별 리스크 점수]                │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 3.1.3 입력 파라미터 (사이드바)
- **날짜 선택**: Date Input (기본값: 오늘)
- **코인 선택**: Selectbox (BTC / ETH, 기본값: BTC)
- **모델 버전**: Selectbox (기본 모델 / 최적화 모델)

#### 3.1.4 출력 결과
1. **리스크 점수 카드 (3개)**
   - 고변동성 확률: 0~100% (게이지 차트)
   - 청산 리스크 점수: 0~100% (게이지 차트)
   - 종합 리스크 점수: 낮음/중간/높음 (색상 코딩)

2. **주요 지표 카드 (3개)**
   - 고래 집중도 변화 (7일): Line Chart
   - 펀딩비 변화 (7일): Line Chart
   - OI 변화율 (7일): Line Chart

3. **예측 상세 정보**
   - 다음날 고변동성 확률
   - 예상 변동성 범위
   - 권장 조치 (자동 생성)

4. **최근 리스크 이력**
   - 30일 타임라인 차트 (날짜별 리스크 점수)

---

### 3.2 역사적 분석 (Historical Analysis)

#### 3.2.1 목적
**과거 데이터를 기반으로 리스크 패턴을 분석하고, 모델의 예측 정확도를 확인**

#### 3.2.2 레이아웃

```
┌─────────────────────────────────────────────────────────┐
│  📊 역사적 리스크 분석                                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [사이드바]                                              │
│  • 기간: 2024-01-01 ~ 2025-11-22                        │
│  • 코인: BTC / ETH                                       │
│  • 분석 모드: 전체 / 고변동성 구간만                     │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📈 리스크 점수 타임라인                           │  │
│  │  [대형 Line Chart: 날짜별 리스크 점수]             │  │
│  │  • 실제 고변동성 구간 표시 (빨간 점)                │  │
│  │  • 예측 고변동성 구간 표시 (노란 영역)              │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │  📊 성과 지표     │  │  🎯 예측 정확도   │           │
│  │  • AUC-ROC: 0.64 │  │  • Precision: 28%│           │
│  │  • Accuracy: 58% │  │  • Recall: 54%   │           │
│  │  • F1-Score: 0.37│  │  • F1-Score: 0.37│           │
│  └──────────────────┘  └──────────────────┘           │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📋 고변동성 구간 목록                             │  │
│  │  [테이블: 날짜, 예측 확률, 실제 변동성, 정확도]     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  🔍 지표별 상관관계 분석                            │  │
│  │  [히트맵: 고래 집중도, 펀딩비, OI, 변동성 상관관계] │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 3.2.3 입력 파라미터 (사이드바)
- **기간 선택**: Date Input (From / To)
- **코인 선택**: Selectbox (BTC / ETH)
- **분석 모드**: Radio (전체 / 고변동성 구간만)
- **모델 버전**: Selectbox

#### 3.2.4 출력 결과
1. **리스크 점수 타임라인**
   - 대형 Line Chart (날짜별 리스크 점수)
   - 실제 고변동성 구간 표시 (빨간 점)
   - 예측 고변동성 구간 표시 (노란 영역)

2. **성과 지표 카드 (2개)**
   - AUC-ROC, Accuracy, F1-Score
   - Precision, Recall, F1-Score (고변동성)

3. **고변동성 구간 목록**
   - 테이블: 날짜, 예측 확률, 실제 변동성, 정확도

4. **지표별 상관관계 분석**
   - 히트맵: 고래 집중도, 펀딩비, OI, 변동성 상관관계

---

### 3.3 특성 분석 (Feature Analysis)

#### 3.3.1 목적
**모델이 어떤 지표를 중요하게 보는지 분석하고, SHAP 값을 통해 예측 근거를 설명**

#### 3.3.2 레이아웃

```
┌─────────────────────────────────────────────────────────┐
│  🔍 특성 중요도 분석                                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📊 특성 중요도 (Feature Importance)              │  │
│  │  [Horizontal Bar Chart: 상위 10개 특성]           │  │
│  │  1. whale_conc_change_7d: 678                    │  │
│  │  2. avg_funding_rate: 612                        │  │
│  │  3. funding_rate_zscore: 557                     │  │
│  │  ...                                              │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  🎯 SHAP 값 분석 (예측 설명)                       │  │
│  │  [Waterfall Chart: 특성별 기여도]                 │  │
│  │  • 특정 날짜의 예측을 각 특성이 어떻게 기여했는지  │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  📈 특성별 분포 및 영향                            │  │
│  │  [Partial Dependence Plot: 주요 특성 3~4개]       │  │
│  │  • 고래 집중도 변화 vs 리스크 점수                 │  │
│  │  • 펀딩비 vs 리스크 점수                           │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
│  ┌──────────────────────────────────────────────────┐  │
│  │  🔬 특정 예측 분석                                 │  │
│  │  날짜 선택: [Date Input]                          │  │
│  │  [해당 날짜의 예측 상세 분석]                      │  │
│  └──────────────────────────────────────────────────┘  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 3.3.3 입력 파라미터 (사이드바)
- **분석 날짜**: Date Input (특정 예측 분석용)
- **코인 선택**: Selectbox (BTC / ETH)
- **특성 개수**: Slider (상위 N개 특성, 기본값: 10)

#### 3.3.4 출력 결과
1. **특성 중요도**
   - Horizontal Bar Chart (상위 10개 특성)
   - 각 특성의 중요도 점수

2. **SHAP 값 분석**
   - Waterfall Chart (특성별 기여도)
   - 특정 날짜의 예측을 각 특성이 어떻게 기여했는지

3. **특성별 분포 및 영향**
   - Partial Dependence Plot (주요 특성 3~4개)
   - 고래 집중도 변화 vs 리스크 점수
   - 펀딩비 vs 리스크 점수

4. **특정 예측 분석**
   - 선택한 날짜의 예측 상세 분석
   - 각 특성의 기여도 및 값

---

## 4. 기술 스택

### 4.1 프론트엔드
- **Streamlit**: 웹 프레임워크 (Project 2와 동일)
- **Plotly**: 인터랙티브 차트
- **Pandas**: 데이터 처리

### 4.2 백엔드
- **LightGBM**: 예측 모델 (이미 학습된 모델 로드)
- **SHAP**: 예측 설명 (선택적)
- **SQLite**: 데이터 저장소 (`data/project.db`)

### 4.3 데이터 소스
- `binance_futures_metrics`: 펀딩비, OI, 변동성
- `bitinfocharts_whale`: 고래 집중도, 평균 거래 금액

---

## 5. 구현 우선순위

### Phase 1: 핵심 기능 (MVP)
1. ✅ **리스크 대시보드**
   - 현재 리스크 점수 표시
   - 주요 지표 카드
   - 최근 리스크 이력

2. ✅ **역사적 분석 (기본)**
   - 리스크 점수 타임라인
   - 성과 지표 카드

### Phase 2: 고급 기능
3. ⏳ **특성 분석**
   - 특성 중요도 차트
   - SHAP 값 분석 (SHAP 설치 필요)

4. ⏳ **역사적 분석 (고급)**
   - 고변동성 구간 목록
   - 지표별 상관관계 분석

### Phase 3: 최적화
5. ⏳ **실시간 업데이트**
   - 자동 데이터 갱신
   - 알림 시스템

6. ⏳ **모델 비교**
   - 여러 모델 버전 비교
   - 앙상블 예측

---

## 6. 파일 구조

```
app/
├── main.py                          # 메인 앱 (페이지 라우팅 추가)
├── pages/
│   ├── cost_calculator_page.py      # Project 2
│   ├── strategy_recommender_page.py # Project 2
│   ├── risk_dashboard_page.py       # Project 3 [NEW]
│   ├── historical_analysis_page.py  # Project 3 [NEW]
│   └── feature_analysis_page.py     # Project 3 [NEW]
└── utils/
    ├── data_loader.py               # Project 2 (공통)
    ├── calculator.py                # Project 2
    ├── recommender.py               # Project 2
    ├── visualizer.py                # Project 2 (공통)
    ├── risk_predictor.py            # Project 3 [NEW]
    ├── risk_analyzer.py             # Project 3 [NEW]
    └── feature_explainer.py         # Project 3 [NEW] (SHAP)
```

---

## 7. 데이터 흐름

### 7.1 리스크 예측 프로세스
```
1. 사용자 입력 (날짜, 코인)
   ↓
2. DataLoader: 데이터 로드
   - binance_futures_metrics
   - bitinfocharts_whale
   ↓
3. FeatureEngineer: 특성 생성
   - 고래 집중도 변화 (7일)
   - 펀딩비 Z-Score
   - OI 변화율
   - 변동성 비율
   ↓
4. RiskPredictor: 모델 예측
   - 학습된 LightGBM 모델 로드
   - 예측 확률 계산
   ↓
5. 결과 포맷팅 및 시각화
   - 리스크 점수 (0~100%)
   - 주요 지표 차트
   - 예측 상세 정보
```

### 7.2 모델 로드
- **모델 파일**: `data/project3_model.pkl` (또는 `models/risk_ai_model.pkl`)
- **특성 목록**: `data/project3_features.json`
- **모델 메타데이터**: `data/project3_model_metadata.json` (성과 지표 포함)

---

## 8. UI/UX 디자인 가이드

### 8.1 색상 코딩
- **낮은 리스크**: 🟢 초록색 (0~40%)
- **중간 리스크**: 🟡 노란색 (40~70%)
- **높은 리스크**: 🔴 빨간색 (70~100%)

### 8.2 아이콘
- ⚠️ 리스크 예측
- 📈 리스크 대시보드
- 📊 역사적 분석
- 🔍 특성 분석
- 🎯 예측 정확도
- 📋 고변동성 구간

### 8.3 레이아웃 원칙
- **카드 기반 디자인**: 각 섹션을 카드로 구분
- **반응형 차트**: Plotly 인터랙티브 차트 사용
- **사이드바**: 입력 파라미터는 사이드바에 배치
- **메인 영역**: 결과는 메인 영역에 큰 차트로 표시

---

## 9. 예상 구현 시간

### Phase 1 (MVP)
- **리스크 대시보드**: 4~6시간
- **역사적 분석 (기본)**: 3~4시간
- **통합 및 테스트**: 2~3시간
- **총계**: 9~13시간

### Phase 2 (고급 기능)
- **특성 분석**: 4~6시간
- **역사적 분석 (고급)**: 3~4시간
- **총계**: 7~10시간

### Phase 3 (최적화)
- **실시간 업데이트**: 3~4시간
- **모델 비교**: 2~3시간
- **총계**: 5~7시간

---

## 10. 참고사항

### 10.1 모델 성능
- 현재 모델의 AUC-ROC: 0.64 (약간의 예측 능력)
- Precision: 0.28 (낮음)
- Recall: 0.54 (중간)
- **UI에서 모델 성능의 한계를 명확히 표시해야 함**

### 10.2 데이터 제약
- OI 데이터는 최근 30일만 수집 가능 (Binance API 제한)
- 고래 데이터는 일별 집계만 가능
- **UI에서 데이터 제약을 명확히 표시해야 함**

### 10.3 SHAP 의존성
- SHAP 분석은 `pip install shap` 필요
- SHAP가 없어도 기본 기능은 동작해야 함
- **SHAP 없이도 특성 중요도는 표시 가능 (LightGBM 내장)**

---

## 11. 다음 단계

1. ✅ **기획서 작성 완료** (현재 문서)
2. ⏳ **Phase 1 구현 시작**
   - `risk_predictor.py` 작성
   - `risk_dashboard_page.py` 작성
   - `main.py`에 페이지 라우팅 추가
3. ⏳ **테스트 및 검증**
4. ⏳ **Phase 2 구현**

---

**작성자**: AI Assistant  
**최종 수정일**: 2025-11-23

