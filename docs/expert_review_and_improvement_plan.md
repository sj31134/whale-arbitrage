# 📊 서브 프로젝트 전문가 비평 및 보완 계획

> **작성일**: 2025-01-XX  
> **목적**: Project 2 (Arbitrage) 및 Project 3 (Risk AI) 결과물에 대한 전문가 비평 및 보완 계획 수립

---

## 1. 프로젝트 목적 상기

### Project 2: Arbitrage (차익거래 백테스트)
- **목표**: 업비트(KRW)와 바이낸스(USDT) 간의 시세 괴리(김치 프리미엄)와 펀딩비 트렌드를 분석하여 통계적 차익거래 기회를 백테스트
- **핵심 가설**: 프리미엄이 평균 회귀하는 특성을 활용하여 Z-Score 기반 진입/청산 신호 생성

### Project 3: Risk AI (변동성/청산 리스크 예측)
- **목표**: BitInfoCharts 고래 지표와 바이낸스 선물 펀딩/OI 데이터를 결합하여 급격한 변동성 및 청산 리스크를 예측하는 AI 모델 구축
- **핵심 가설**: 고래 집중도 변화, 펀딩비 이상, OI 급증 등이 고변동성 선행 지표로 작용

---

## 2. 현재 결과물 리뷰

### 2.1 Project 2: Arbitrage 백테스트 결과

#### ✅ 성과 지표
- **총 거래 횟수**: 36회
- **최종 수익률**: 27.34% (약 2년 10개월)
- **승률**: 88.9%
- **MDD (Maximum Drawdown)**: -1.64%
- **Sharpe Ratio**: 6.19

#### 📊 거래 패턴 분석
- 평균 보유 기간: 약 4-5일
- Long Premium 거래: 13회
- Short Premium 거래: 23회
- 최대 손실: -1.89% (2024-02-28 ~ 2024-03-24)

---

### 2.2 Project 3: Risk AI 모델 결과

#### ⚠️ 주요 이슈
- **AUC-ROC**: `nan` (타겟 변수가 모두 0)
- **특성 중요도**: 모두 0
- **예측 결과**: 모든 테스트 데이터가 0으로 예측됨

#### 🔍 근본 원인
1. **`volatility_24h` 컬럼이 모두 0.0으로 저장됨**
   - Binance Futures API에서 변동성 데이터를 제대로 수집하지 못함
   - `fetch_futures_metrics.py`에서 변동성 계산 로직 누락 또는 API 응답 파싱 오류

2. **`sum_open_interest` 컬럼이 모두 0.0으로 저장됨**
   - Open Interest API 제한(최근 30일)으로 인해 과거 데이터가 0으로 채워짐
   - 일별 집계 로직이 제대로 작동하지 않음

3. **타겟 변수 생성 실패**
   - `volatility_24h`가 모두 0이므로 `target_high_vol`이 모두 0이 됨
   - 모델이 학습할 수 있는 패턴이 없음

---

## 3. 전문가 비평

### 3.1 금융 데이터 분석 전문가 비평

#### Project 2 (Arbitrage)
**강점:**
- ✅ Z-Score 기반 평균 회귀 전략은 학술적으로 검증된 방법론
- ✅ 수수료 및 슬리피지를 고려한 현실적인 백테스트
- ✅ 승률 88.9%는 매우 높은 수준

**약점 및 개선 필요:**
1. **거래 실행 가능성 검증 부족**
   - 업비트에서 공매도가 불가능한데 "Short Premium" 전략이 실제로 실행 가능한지 불명확
   - 실제로는 보유 BTC 매도 + 바이낸스 선물 매수 조합이 필요할 수 있음
   - **보완 필요**: 선물 시장 활용 방안 추가 검토

2. **자금 배분 가정이 단순함**
   - 현재: 자본 50:50 분할 가정
   - 실제: 업비트/바이낸스 간 자금 이동 비용, 환전 비용, 시간 지연 고려 필요
   - **보완 필요**: 자금 이동 비용 및 시간 지연 시뮬레이션 추가

3. **리스크 관리 부재**
   - 손절매(Stop Loss) 로직 없음
   - 최대 보유 기간 제한 없음 (무한 보유 가능)
   - **보완 필요**: 손절매 및 최대 보유 기간 설정

4. **백테스트 기간의 시장 특성 미고려**
   - 2023-2025 기간은 특정 시장 상황(예: 규제 변화, 거래소 이슈)이 있을 수 있음
   - **보완 필요**: 시장 이벤트별 성과 분석 추가

#### Project 3 (Risk AI)
**강점:**
- ✅ 고래 지표와 선물 시장 데이터 결합은 혁신적인 접근
- ✅ Feature Engineering에서 Z-Score, 변화율 등 다양한 파생 변수 생성

**약점 및 개선 필요:**
1. **데이터 수집 품질 문제 (Critical)**
   - `volatility_24h`와 `sum_open_interest`가 모두 0으로 저장되어 모델 학습 불가
   - **보완 필요**: 데이터 수집 스크립트 수정 및 재수집

2. **타겟 변수 정의의 문제**
   - 현재: 상위 20% 변동성을 고변동성으로 정의
   - 문제: `volatility_24h`가 모두 0이면 threshold가 0이 되어 모든 데이터가 0으로 분류됨
   - **보완 필요**: 타겟 변수를 절대 수치 기반으로 재정의 (예: 5% 이상)

3. **불균형 데이터 처리 부족**
   - 고변동성 구간은 전체의 20% 미만일 가능성이 높음
   - `class_weight='balanced'`만으로는 부족할 수 있음
   - **보완 필요**: SMOTE, 언더샘플링 등 추가 기법 검토

4. **특성 선택의 근거 부족**
   - 현재 7개 특성 선택 근거가 불명확
   - 상관관계 분석, 다중공선성 검토 없음
   - **보완 필요**: 특성 상관관계 분석 및 중요도 기반 선택

---

### 3.2 백테스트 전문가 비평

#### Project 2 (Arbitrage)
**약점:**
1. **Look-ahead Bias 가능성**
   - Z-Score 계산 시 30일 이동평균 사용
   - 첫 30일 데이터는 제외해야 하는데, 현재는 `dropna()`로만 처리
   - **보완 필요**: 첫 30일 데이터를 명시적으로 제외

2. **거래 비용 과소평가 가능성**
   - 수수료 0.05% + 슬리피지 0.02% = 0.07% (왕복 0.14%)
   - 실제: 환전 비용, 자금 이동 비용, 시간 지연으로 인한 기회비용 미고려
   - **보완 필요**: 실제 거래 비용 시뮬레이션 추가

3. **성과 지표의 신뢰성**
   - Sharpe Ratio 계산이 단순화됨 (연율화 미적용)
   - MDD 계산이 거래별로만 수행됨 (일별 자본 곡선 기준 필요)
   - **보완 필요**: 표준 성과 지표 재계산 (연율화 Sharpe, 일별 MDD)

4. **벤치마크 비교 부재**
   - 단순 보유(Buy & Hold) 대비 성과 비교 없음
   - **보완 필요**: 벤치마크 대비 성과 분석 추가

---

### 3.3 머신러닝 모델링 전문가 비평

#### Project 3 (Risk AI)
**약점:**
1. **데이터 품질 문제 (Critical)**
   - 핵심 특성(`volatility_24h`, `sum_open_interest`)이 모두 0
   - 모델 학습 자체가 불가능한 상태
   - **보완 필요**: 데이터 수집 스크립트 수정 및 재수집 (최우선)

2. **타겟 변수 정의 문제**
   - 상위 20% 기준은 데이터 분포에 따라 달라질 수 있음
   - **보완 필요**: 절대 수치 기반 타겟 변수 정의 (예: 변동성 5% 이상)

3. **모델 검증 부족**
   - Train/Test Split만 수행, Cross-Validation 없음
   - Time Series 데이터인데 Random Split 사용 (현재는 Time Split이지만 검증 없음)
   - **보완 필요**: Time Series Cross-Validation 적용

4. **하이퍼파라미터 튜닝 부재**
   - 기본 파라미터만 사용
   - **보완 필요**: GridSearch 또는 Optuna를 활용한 하이퍼파라미터 튜닝

5. **모델 해석성 부족**
   - SHAP 값, 특성 기여도 분석 없음
   - **보완 필요**: SHAP 분석 추가

---

### 3.4 암호화폐 시장 전문가 비평

#### 공통 이슈
1. **시장 구조 이해 부족**
   - 업비트는 한국 거래소, 바이낸스는 글로벌 거래소
   - 거래 시간대 차이, 유동성 차이 미고려
   - **보완 필요**: 거래 시간대별 유동성 분석 추가

2. **규제 리스크 미고려**
   - 한국의 암호화폐 규제 변화가 프리미엄에 미치는 영향
   - **보완 필요**: 규제 이벤트별 성과 분석

3. **고래 데이터의 신뢰성**
   - BitInfoCharts 데이터가 얼마나 정확한지 검증 필요
   - **보완 필요**: 다른 데이터 소스와의 교차 검증

---

## 4. 보완 계획

### 4.1 Project 2 (Arbitrage) 보완 계획

#### 우선순위 1: 데이터 수집 보완
- [ ] **환율 데이터 완전성 검증**
  - ECOS API로 수집한 환율 데이터의 결측치 확인
  - 결측치가 있는 날짜에 대한 대체 방안 수립 (전일 값 사용 또는 보간)

#### 우선순위 2: 백테스트 엔진 개선
- [ ] **실행 가능성 검증**
  - 업비트 공매도 불가능 문제 해결 방안 수립
  - 선물 시장 활용 방안 추가 (바이낸스 선물 매수/매도)
  - 자금 이동 비용 및 시간 지연 시뮬레이션 추가

- [ ] **리스크 관리 로직 추가**
  - 손절매(Stop Loss) 로직 구현 (예: -3% 손실 시 강제 청산)
  - 최대 보유 기간 제한 (예: 30일 초과 시 강제 청산)
  - 포지션 크기 제한 (예: 자본의 50% 이상 투자 금지)

- [ ] **성과 지표 개선**
  - 일별 자본 곡선 생성
  - 연율화 Sharpe Ratio 계산
  - 일별 MDD 재계산
  - 벤치마크 대비 성과 분석 (단순 보유 대비)

- [ ] **Look-ahead Bias 제거**
  - 첫 30일 데이터를 명시적으로 제외
  - Walk-forward 분석 적용 (과거 데이터만 사용하여 미래 예측)

#### 우선순위 3: 추가 분석
- [ ] **시장 이벤트별 성과 분석**
  - 규제 이벤트, 거래소 이슈 등 시장 이벤트별 성과 분석
  - 시장 상황별 전략 성과 비교

- [ ] **파라미터 민감도 분석**
  - Entry Z-Score (현재 2.0) 변경 시 성과 변화
  - Exit Z-Score (현재 0.5) 변경 시 성과 변화
  - 이동평균 기간 (현재 30일) 변경 시 성과 변화

---

### 4.2 Project 3 (Risk AI) 보완 계획

#### 우선순위 1: 데이터 수집 문제 해결 (Critical)
- [ ] **`volatility_24h` 수집 로직 수정**
  - `fetch_futures_metrics.py`에서 Binance 24hr Ticker API 호출 확인
  - `priceChangePercent` 또는 `highPrice - lowPrice` 기반 변동성 계산 로직 추가
  - 재수집 스크립트 실행

- [ ] **`sum_open_interest` 수집 로직 개선**
  - Open Interest API 제한(30일) 문제 해결 방안 수립
  - 일별 집계 로직 수정 (시간별 데이터를 일별로 집계)
  - 과거 데이터는 Wayback Machine 또는 다른 데이터 소스 활용 검토

- [ ] **데이터 품질 검증 스크립트 작성**
  - 각 컬럼의 NULL 비율, 0 값 비율 확인
  - 이상치(Outlier) 검출 및 처리

#### 우선순위 2: 타겟 변수 재정의
- [ ] **절대 수치 기반 타겟 변수 정의**
  - 변동성 5% 이상을 고변동성으로 정의
  - 또는 변동성 3% 이상 + OI 급증(7일 평균 대비 20% 이상) 조합

- [ ] **타겟 변수 분포 분석**
  - 고변동성 구간 비율 확인
  - 불균형 정도 측정

#### 우선순위 3: Feature Engineering 개선
- [ ] **특성 상관관계 분석**
  - 특성 간 상관관계 매트릭스 생성
  - 다중공선성 검토 (VIF 계산)
  - 불필요한 특성 제거

- [ ] **추가 특성 생성**
  - 고래 집중도 변화율의 이동평균
  - 펀딩비와 OI의 상호작용 특성
  - 시장 상황 특성 (상승장/하락장 구분)

#### 우선순위 4: 모델 개선
- [ ] **불균형 데이터 처리**
  - SMOTE 적용
  - 언더샘플링 검토
  - Focal Loss 적용 검토

- [ ] **모델 검증 개선**
  - Time Series Cross-Validation 적용
  - 여러 시점에서의 성과 검증

- [ ] **하이퍼파라미터 튜닝**
  - Optuna를 활용한 자동 하이퍼파라미터 튜닝
  - 주요 파라미터: `n_estimators`, `learning_rate`, `max_depth`, `min_child_samples`

- [ ] **모델 해석성 향상**
  - SHAP 값 계산 및 시각화
  - 특성 기여도 분석
  - 예측 결과 해석 리포트 생성

#### 우선순위 5: 추가 분석
- [ ] **모델 성능 평가 개선**
  - Precision-Recall Curve
  - Confusion Matrix 상세 분석
  - 예측 시점별 성과 분석 (1일 후, 3일 후, 7일 후)

- [ ] **벤치마크 모델 비교**
  - 단순 규칙 기반 모델 (예: 펀딩비 > 0.1% 시 고변동성 예측)
  - 선형 모델 (Logistic Regression)
  - 랜덤 포레스트

---

### 4.3 공통 보완 사항

#### 문서화
- [ ] **결과 리포트 작성**
  - Project 2: 백테스트 결과 상세 리포트 (거래별 분석, 시장 상황별 성과)
  - Project 3: 모델 성능 리포트 (특성 중요도, 예측 정확도, 오분류 사례 분석)

- [ ] **재현 가능성 보장**
  - 모든 스크립트에 시드(Seed) 설정
  - 파라미터를 설정 파일로 분리
  - 실행 순서 및 의존성 문서화

#### 코드 품질
- [ ] **에러 처리 강화**
  - API 호출 실패 시 재시도 로직
  - 데이터 검증 로직 추가

- [ ] **로깅 개선**
  - 상세한 로그 기록
  - 성과 지표 로깅

---

## 5. 실행 우선순위

### 즉시 실행 (Critical)
1. **Project 3 데이터 수집 문제 해결**
   - `volatility_24h` 수집 로직 수정
   - `sum_open_interest` 수집 로직 개선
   - 재수집 및 검증

### 단기 (1주일 이내)
2. **Project 2 백테스트 엔진 개선**
   - 리스크 관리 로직 추가
   - 성과 지표 개선
   - Look-ahead Bias 제거

3. **Project 3 타겟 변수 재정의 및 모델 재학습**
   - 절대 수치 기반 타겟 변수 정의
   - 데이터 재수집 후 모델 재학습

### 중기 (2-3주 이내)
4. **Project 2 실행 가능성 검증**
   - 선물 시장 활용 방안 추가
   - 자금 이동 비용 시뮬레이션

5. **Project 3 모델 개선**
   - 불균형 데이터 처리
   - 하이퍼파라미터 튜닝
   - SHAP 분석

### 장기 (1개월 이내)
6. **추가 분석 및 리포트 작성**
   - 시장 이벤트별 성과 분석
   - 파라미터 민감도 분석
   - 최종 리포트 작성

---

## 6. 예상 소요 시간

| 작업 | 예상 시간 |
|------|----------|
| Project 3 데이터 수집 문제 해결 | 4-6시간 |
| Project 2 백테스트 엔진 개선 | 8-12시간 |
| Project 3 타겟 변수 재정의 및 재학습 | 4-6시간 |
| Project 2 실행 가능성 검증 | 6-8시간 |
| Project 3 모델 개선 | 12-16시간 |
| 추가 분석 및 리포트 작성 | 8-12시간 |
| **총계** | **42-60시간** |

---

## 7. 참고 자료

- [Binance API Documentation](https://binance-docs.github.io/apidocs/)
- [Upbit API Documentation](https://docs.upbit.com/)
- [Time Series Cross-Validation](https://scikit-learn.org/stable/modules/cross_validation.html#time-series-split)
- [SHAP Documentation](https://shap.readthedocs.io/)
- [Optuna Documentation](https://optuna.org/)

---

**작성자**: AI Assistant  
**검토 필요**: 금융 데이터 분석 전문가, 백테스트 전문가, 머신러닝 전문가

