# 자동매매 봇 사용 가이드

## 개요

기존 프로젝트의 분석 결과를 활용한 데이터 기반 자동매매 시스템입니다.
- 기존 RiskPredictor의 고변동성 확률 활용
- 특성 중요도 기반 가중치 적용
- 동적 변수 분석
- 김치 프리미엄 필터

## 설치

### 1. 의존성 설치

```bash
python install_trading_bot.py
```

또는 수동 설치:

```bash
pip install -r requirements_trading_bot.txt
```

### 2. 디렉토리 확인

다음 디렉토리가 자동으로 생성됩니다:
- `trading_bot/data/` - 포지션 데이터 저장
- `trading_bot/config/` - 설정 파일
- `logs/` - 로그 파일

## 설정

### 1. API 키 발급

#### 업비트 API
1. https://upbit.com 접속
2. 마이페이지 > Open API 관리
3. Access Key, Secret Key 발급
4. **주의**: IP 주소 등록 필요

#### 텔레그램 봇 (선택사항)
1. @BotFather에서 봇 생성
2. 봇 토큰 발급
3. @userinfobot으로 채팅 ID 조회

### 2. Streamlit UI에서 설정

1. Streamlit 앱 실행:
   ```bash
   streamlit run app/main.py
   ```

2. "🤖 자동매매 봇" 메뉴 선택

3. "⚙️ 설정" 탭에서:
   - 업비트 API 키 입력
   - 텔레그램 설정 (선택)
   - 거래 파라미터 설정
   - "💾 설정 저장" 클릭

### 3. 주요 설정 항목

#### 거래 설정
- **대상 코인**: BTC 또는 ETH
- **초기 자본금**: 사용할 자본금 (원)
- **최대 포지션 비율**: 자본금 대비 최대 포지션 비율 (0.1 ~ 0.5)
- **손절매 비율**: 손실 허용 비율 (예: -5%)
- **익절 비율**: 수익 실현 비율 (예: +10%)

#### 전략 설정
- **변동성 윈도우**: K값 계산 기간 (일)
- **체크 간격**: 시그널 확인 간격 (초)

## 사용 방법

### 1. 봇 시작

1. "🎮 제어" 탭으로 이동
2. "▶️ 봇 시작" 버튼 클릭
3. 봇 상태가 "🟢 실행 중"으로 변경되는지 확인

### 2. 모니터링

"📊 모니터링" 탭에서 확인 가능:
- 봇 실행 상태
- 현재 포지션 정보
- 수익률
- 잔고 정보

### 3. 봇 중지

"🎮 제어" 탭에서 "⏹️ 봇 중지" 버튼 클릭

## 매매 전략

### 매수 조건

다음 조건을 모두 만족해야 매수:
1. **김치 프리미엄 필터**: 역프(-1% 이하) 또는 낮은 김프(2% 이하)
2. **데이터 기반 시그널**: 종합 점수 60점 이상
   - 변동성 점수 (40%): 고변동성 확률이 낮을수록 높음
   - 특성 점수 (40%): 특성 중요도 기반 평가
   - 동적 변수 점수 (20%): 동적 변수 변화 평가
3. **고래 시그널**: 고래 순매수 상태

### 매도 조건

다음 중 하나라도 만족하면 매도:
1. **익절**: 수익률이 설정한 익절 비율 이상
2. **손절**: 수익률이 설정한 손절 비율 이하
3. **고변동성**: 고변동성 확률이 50% 이상
4. **고래 매도 위험**: 거래소 유입 급증 감지

### 포지션 크기

- 기본: 자본금 × 최대 포지션 비율
- 역프 상태: 기본 × 2배

## 로그 확인

로그 파일 위치: `logs/trading_bot.log`

주요 로그 내용:
- 봇 시작/중지
- 시그널 생성
- 주문 실행
- 에러 발생

## 주의사항

### ⚠️ 중요

1. **모의투자 테스트 필수**
   - 실거래 전 반드시 모의투자 환경에서 테스트
   - 충분한 기간 테스트 후 실거래 사용

2. **API 키 보안**
   - API 키는 절대 공유하지 마세요
   - IP 주소 등록 필수
   - 출금 권한은 비활성화 권장

3. **리스크 관리**
   - 초기 자본금은 여유 있게 설정
   - 최대 포지션 비율은 신중하게 설정
   - 손절매/익절 비율은 시장 상황에 맞게 조정

4. **시장 상황**
   - 급격한 시장 변동 시 봇 중지 고려
   - 네트워크 오류 시 자동 재시도되지만 모니터링 필요

## 트러블슈팅

### 봇이 시작되지 않을 때

1. API 키 확인
   - 업비트 API 키가 올바른지 확인
   - IP 주소 등록 확인

2. 설정 확인
   - "설정" 탭에서 모든 필수 항목 입력 확인
   - 설정 저장 확인

3. 로그 확인
   - `logs/trading_bot.log` 파일 확인
   - 에러 메시지 확인

### 주문이 실행되지 않을 때

1. 잔고 확인
   - 원화 잔고가 충분한지 확인
   - 최소 주문 금액 확인 (업비트 기준)

2. 시그널 확인
   - "모니터링" 탭에서 시그널 점수 확인
   - 매수 조건 만족 여부 확인

3. API 상태 확인
   - 업비트 API 상태 확인
   - 네트워크 연결 확인

### 텔레그램 알림이 오지 않을 때

1. 봇 토큰 확인
   - @BotFather에서 봇 토큰 확인
   - 봇이 활성화되어 있는지 확인

2. 채팅 ID 확인
   - @userinfobot으로 채팅 ID 확인
   - 봇과 대화를 시작했는지 확인

## FAQ

### Q: 기존 데이터 수집 서비스에 영향을 주나요?
A: 아닙니다. 봇은 기존 DB를 읽기 전용으로만 사용하며, 별도 설정 파일을 사용합니다.

### Q: 여러 코인을 동시에 거래할 수 있나요?
A: 현재는 한 번에 하나의 코인만 거래 가능합니다. 설정에서 대상 코인을 변경할 수 있습니다.

### Q: 백테스트 기능이 있나요?
A: 현재는 실시간 거래만 지원합니다. 백테스트는 별도로 구현 필요합니다.

### Q: 모바일에서도 사용할 수 있나요?
A: Streamlit 앱이므로 모바일 브라우저에서도 접근 가능합니다. 다만 봇은 서버에서 실행되므로 서버가 계속 실행되어야 합니다.

## 지원

문제 발생 시:
1. 로그 파일 확인 (`logs/trading_bot.log`)
2. 설정 확인
3. GitHub Issues에 문의

