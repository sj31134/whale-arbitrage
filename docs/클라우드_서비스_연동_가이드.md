# 클라우드 서비스 연동 가이드

## 📋 개요

클라우드 환경(Streamlit Cloud)에서 Supabase를 통한 데이터 접근을 지원합니다.

## 🔧 Streamlit Cloud 설정

### 1. Secrets 설정

Streamlit Cloud 대시보드에서 다음 Secrets를 추가하세요:

```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-service-role-key
```

또는

```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

### 2. 환경 변수 확인

- `SUPABASE_URL`: Supabase 프로젝트 URL
- `SUPABASE_KEY` 또는 `SUPABASE_SERVICE_ROLE_KEY`: Supabase Service Role Key

## 🔄 동작 방식

### 클라우드 환경 (Streamlit Cloud)

1. **자동 감지**: `/mount/src` 경로 존재 시 클라우드 환경으로 감지
2. **Supabase 우선 사용**: 클라우드 환경에서는 Supabase를 우선 사용
3. **SQLite 폴백**: Supabase 연결 실패 시 SQLite로 폴백

### 로컬 환경

1. **SQLite 사용**: 기본적으로 로컬 SQLite DB 사용
2. **Supabase 옵션**: 필요 시 환경 변수로 Supabase 사용 가능

## 📊 지원되는 데이터 로딩 함수

### 1. `load_futures_extended_metrics`

파생상품 확장 지표 로드:
- `futures_extended_metrics` 테이블에서 데이터 로드
- Supabase 우선 사용, 실패 시 SQLite 폴백

### 2. `load_risk_data`

리스크 데이터 로드:
- `binance_futures_metrics` + `bitinfocharts_whale` 테이블 조인
- Supabase에서 두 테이블을 각각 로드 후 병합

## 🐛 문제 해결

### 파생상품 데이터를 불러오지 못하는 경우

1. **Secrets 확인**
   - Streamlit Cloud 대시보드에서 Secrets 설정 확인
   - `SUPABASE_URL`과 `SUPABASE_KEY`가 올바르게 설정되었는지 확인

2. **Supabase 테이블 확인**
   - `futures_extended_metrics` 테이블이 존재하는지 확인
   - `binance_futures_metrics` 테이블이 존재하는지 확인
   - 데이터가 실제로 존재하는지 확인

3. **로그 확인**
   - Streamlit Cloud 로그에서 Supabase 연결 오류 확인
   - "Supabase 초기화 실패" 메시지 확인

### SQLite 폴백이 작동하지 않는 경우

1. **파일 경로 확인**
   - `/tmp/project.db` 경로에 파일이 있는지 확인
   - DATABASE_URL Secret이 설정되어 있는지 확인

2. **권한 확인**
   - `/tmp` 디렉토리에 쓰기 권한이 있는지 확인

## 📝 참고 사항

- 클라우드 환경에서는 Supabase를 우선 사용하므로 SQLite 파일이 없어도 작동합니다.
- 로컬 환경에서는 기본적으로 SQLite를 사용합니다.
- Supabase 연결 실패 시 자동으로 SQLite로 폴백합니다.

